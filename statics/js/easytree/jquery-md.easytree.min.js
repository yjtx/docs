/*! dev.egret.com - v1.0.0 - 2016-08-03 */!function(a){a.fn.easytree=function(a){var c=this,d=new b(c,a);return d};var b=function(b,c){function d(b){var c=n(this),d=b.data,e=o(d,c);if(e&&(s(d),Q.allowActivate&&(e.isActive=!0,a("#"+e.id).addClass("easytree-active"),Q.stateChanged))){var f=G(d);Q.stateChanged(d,f,e)}}function e(a){var b=n(this),c=a.data,d=o(c,b);d&&f(a,c,d)}function f(b,c,d){var e="";if(Q.toggling&&(e=Q.toggling(b,c,d),e===!1))return!1;if(d.isExpanded){if(Q.closing&&(e=Q.closing(b,c,d),e===!1))return!1}else if(Q.opening&&(e=Q.opening(b,c,d),e===!1))return!1;if(d.isLazy&&!d.isExpanded){var f=d.children&&d.children.length>0;if(e=!0,Q.openLazyNode&&(e=Q.openLazyNode(b,c,d,f)),d.lazyUrl&&e!==!1)return J(d.lazyUrl,d.lazyUrlJson,function(e){e.d&&(e=e.d);var f=K(e);a.isArray(f)?d.children=f:(d.children=[],d.children.push(f)),w(c),g(b,c,d)}),!1}g(b,c,d)}function g(a,b,c){if(c.isExpanded?(r(b,c.id,"close"),C(c,"close"),Q.closed&&Q.closed(a,b,c)):(r(b,c.id,"open"),C(c,"open"),Q.opened&&Q.opened(a,b,c)),Q.toggled){Q.toggled(a,b,c)}}function h(b){if(Q.enableDnd){for(var c=b.target;c&&!(c.className.indexOf("easytree-draggable")>-1);)c=c.parentElement;if(c)return t(R),s(R),a("#"+c.id).addClass("easytree-drag-source"),m(S),S.createClone=!(c.className.indexOf("easytree-no-clone")>-1),S.dragok=!0,S.sourceEl=c,S.sourceId=c.id,S.sourceNode=o(R,S.sourceId),!1}}function i(b){if(S.dragok&&Q.enableDnd){S.createClone&&(S.clone||(S.clone=k(S.sourceEl),a(S.clone).appendTo("body")),S.clone.style.left=b.pageX+5+"px",S.clone.style.top=b.pageY+"px");var c=l(b.clientX,b.clientY);if(!c)return D(),S.targetEl=null,S.targetId=null,S.targetNode=null,void(S.canDrop=!1);if(c.id!=S.targetId){S.canDrop=!1,window.clearTimeout(S.openDelayTimeout),S.targetEl=c,S.targetId=c.id,S.targetNode=o(R,S.targetId),O("source:"+(S.sourceNode&&S.sourceNode.text?S.sourceNode.text:S.sourceId)),O("target:"+(S.targetNode&&S.targetNode.text?S.targetNode.text:S.targetId)),O("isAncester:"+p(S.sourceNode,S.targetId));var d=a("#"+S.targetId);if(p(S.sourceNode,S.targetId))return void F();if(S.targetId==S.sourceId)return void D();if(Q.canDrop){var e=null!=S.sourceNode,f=e?S.sourceNode:S.sourceEl,g=null!=S.targetNode,h=g?S.targetNode:S.targetEl,i=Q.canDrop(b,R,e,f,g,h);if(i===!0)return E(),S.canDrop=!0,void(S.openDelayTimeout=window.setTimeout(function(){r(R,S.targetId,"open"),C(S.targetNode,"open")},600));if(i===!1)return void F()}return d.hasClass("easytree-reject")?F():d.hasClass("easytree-accept")?(E(),S.canDrop=!0,S.openDelayTimeout=window.setTimeout(function(){r(R,S.targetId,"open"),C(S.targetNode,"open")},600)):D(),!1}}}function j(b){var c=null!=S.sourceNode,d=c?S.sourceNode:S.sourceEl,e=null!=S.targetNode,f=e?S.targetNode:S.targetEl,g=S.canDrop;if(D(),a("#_st_clone_").remove(),null===d||null===f)return m(S),!1;if(Q.dropping){var h=Q.dropping(b,R,c,d,e,f,g);if(h===!1)return void m(S)}return S.targetNode&&S.sourceNode&&g&&(S.targetNode.children||(S.targetNode.children=[]),q(R,S.sourceId),S.targetNode.children.push(S.sourceNode)),g&&(Q.dropped&&Q.dropped(b,R,c,d,e,f),w(R)),m(S),!1}function k(b){a(b).remove(".easytree-expander");var c=a(b).clone().remove(".easytree-expander").removeClass("easytree-drag-source")[0],d=c.children[0];return d&&"easytree-expander"==d.className&&c.removeChild(d),c.style.display="block",c.style.position="absolute",c.style.opacity=.5,c.id="_st_clone_",c.style.zIndex=1e3,c}function l(a,b){for(var c=document.elementFromPoint(a,b);c;){if(c.className.indexOf("easytree-droppable")>-1)return c;c=c.parentElement}return null}function m(a){a.canDrop=!1,a.createClone=!0,a.clone=null,a.dragok=!1,a.openDelayTimeout=null,a.targetEl=null,a.targetId=null,a.targetNode=null,a.sourceEl=null,a.sourceId=null,a.sourceNode=null}function n(a){for(;null!=a;){if(a.id)return a.id;a=a.parentElement}return null}function o(a,b){var c=0;for(c=0;c<a.length;c++){var d=a[c];d.text;if(d.id==b)return d;var e=d.children&&d.children.length>0;if(e){var f=o(d.children,b);if(f)return f}}return null}function p(a,b){var c=0;if(!a||!a.children||0==a.children.length)return!1;for(c=0;c<a.children.length;c++){var d=a.children[c];d.text;if(d.id==b)return!0;var e=d.children&&d.children.length>0;if(e){var f=p(d,b);if(f)return f}}return!1}function q(a,b){var c=0;for(c=0;c<a.length;c++){var d=a[c];d.text;if(d.id==b)return void a.splice(c,1);var e=d.children&&d.children.length>0;e&&q(d.children,b)}}function r(a,b,c){var d=0;for(d=0;d<a.length;d++){var e=a[d];e.text;if(e.id==b)return void(e.isExpanded="open"==c);var f=e.children&&e.children.length>0;f&&r(e.children,b,c)}}function s(b){var c=0;for(c=0;c<b.length;c++){var d=b[c];d.isActive=!1,a("#"+d.id).removeClass("easytree-active");var e=d.children&&d.children.length>0;e&&s(d.children)}}function t(b){var c=0;for(c=0;c<b.length;c++){var d=b[c];a("#"+d.id).removeClass("easytree-drag-source");var e=d.children&&d.children.length>0;e&&t(d.children)}}function u(a){var b=0;for(a=a.sort(function(a,b){var c=a.text.toLowerCase(),d=b.text.toLowerCase();c||(c="a"),d||(d="a"),Q.ordering.toLowerCase().indexOf("folder")>-1&&a.isFolder&&(c="______"+c),Q.ordering.toLowerCase().indexOf("folder")>-1&&b.isFolder&&(d="______"+d);var e=Q.ordering.indexOf(" DESC")==-1?1:-1;return c<d?-1*e:c>d?1*e:0}),b=0;b<a.length;b++){var c=a[b],d=c.children&&c.children.length>0;d&&u(c.children)}return a}function v(a,b,c){var d=0;for(b||(b=0,c="_st_node_"+c+"_"),d=0;d<a.length;d++){var e=a[d];e.id||(e.id=c+d.toString());var f=e.children&&e.children.length>0;f&&v(e.children,b+1,c+d+"_")}}function w(b){if(b){new Date;if(Q.building){var c=Q.building(b);if(c===!1)return!1}new Date;Q.ordering&&(b=u(b));var f=(new Date,Math.floor(1e4*Math.random()));v(b,0,f);new Date;R=b;var g=x(b,0,!0);new Date;P[0].innerHTML=g;new Date;a(P.selector+" .easytree-node").on("click",b,d),a(P.selector+" .easytree-expander").on("click",b,e),a(P.selector+" .easytree-icon").on("click",b,e),a(P.selector+" .easytree-title").on("click",b,e);new Date;Q.enableDnd&&(a(document).on("mousedown",h),a(document).on("mousemove",i),a(document).on("mouseup",j));new Date;Q.built&&Q.built(b);new Date;if(Q.stateChanged){var k=G(b);Q.stateChanged(b,k)}new Date}}function x(a,b,c){var d="",e=0,f="";0==b&&(f+="ui-easytree easytree-container easytree-focused");var g=b<Q.minOpenLevels,h=0==b||c||g?"":" style='display:none' ";for(d+='<ul tabindex="0" class="'+f+'" '+h+'">',e=0;e<a.length;e++){var i=a[e];if(i.in_use!==!1){g===!0&&(i.isExpanded=!0);var j=e==a.length-1,k=y(i,j);d+="<li>",d+='<span id="'+i.id+'" class="'+k+' ">',d+=g?"":'<span class="easytree-expander"></span>',d+=A(i),d+=B(i),d+="</span>",i.children&&i.children.length>0&&(d+=x(i.children,b+1,i.isExpanded)),d+="</li>"}}return d+="</ul>"}function y(a,b){var c=(a.children&&a.children.length>0,"easytree-node ");Q.enableDnd&&(c+=" easytree-draggable "),a.liClass&&(c+=a.liClass),a.isFolder&&Q.enableDnd?c+=" easytree-droppable easytree-accept ":Q.enableDnd&&(c+=" easytree-droppable easytree-reject "),a.isActive&&Q.allowActivate&&(c+=" easytree-active "),c+=z(a,b);var d=a.isExpanded?"e":"c";return a.isFolder&&(d+="f"),c+=" easytree-ico-"+d}function z(a,b){var c=a.children&&a.children.length>0,d="";return d=!c&&a.isLazy?"c":c?a.isExpanded?"e":"c":"n",b&&(d+="l")," easytree-exp-"+d}function A(a){var b="";return Q.disableIcons?b:a.uiIcon?'<span class="easytree-custom-icon ui-icon '+a.uiIcon+'"></span>':a.iconUrl?'<span><img src="'+a.iconUrl+'" /></span>':'<span class="easytree-icon"></span>'}function B(a){var b="",c=a.tooltip?'title="'+a.tooltip+'"':"",d="easytree-title";return a.textCss&&(d+=" "+a.textCss),b+="<span "+c+' class="'+d+'">',a.href&&(b+='<a href="'+a.href+'" ',a.hrefTarget&&(b+=' target="'+a.hrefTarget+'" '),b+=">"),b+=a.text,a.href&&(b+="</a>"),b+="</span>"}function C(b,c){if(b){var d=a("#"+b.id).attr("class"),e=d.indexOf("easytree-exp-");if(e>-1){var f=d.indexOf(" ",e),g=f>-1?d.substring(e,f):d.substring(e);a("#"+b.id).removeClass(g),a("#"+b.id).addClass(z(b,!1))}var h=a("#"+b.id).parents("li").first(),i=h.children("ul").first(),j=parseInt(Q.slidingTime,10);"close"==c?(i.slideUp(j),h.removeClass("easytree-unclose"),h.addClass("easytree-close")):(i.slideDown(j),h.removeClass("easytree-close"),h.addClass("easytree-unclose"))}}function D(){a("#easytree-reject").hide(),a("#easytree-accept").hide()}function E(){a("#easytree-accept").show(),a("#easytree-reject").hide()}function F(){a("#easytree-reject").show(),a("#easytree-accept").hide()}function G(a){for(var b=JSON.stringify?JSON.stringify(a):"Please import json2.js";b.indexOf(',"children":[]')>-1;)b=b.replace(',"children":[]',"");for(;b.indexOf('"liClass":"",')>-1;)b=b.replace('"liClass":"",',"");for(;b.indexOf('"textCss":"",')>-1;)b=b.replace('"textCss":"",',"");for(;b.indexOf('"isExpanded":false,')>-1;)b=b.replace('"isExpanded":false,',"");for(;b.indexOf('"isActive":false,')>-1;)b=b.replace('"isActive":false,',"");for(;b.indexOf('"isFolder":false,')>-1;)b=b.replace('"isFolder":false,',"");for(;b.indexOf('"isLazy":false,')>-1;)b=b.replace('"isLazy":false,',"");return b}function H(){I(),m(S),a(document).on("mousemove",function(a){var b=a.pageY,c=a.pageX;document.getElementById("easytree-reject").style.top=b+10+"px",document.getElementById("easytree-reject").style.left=c+17+"px",document.getElementById("easytree-accept").style.top=b+10+"px",document.getElementById("easytree-accept").style.left=c+17+"px"})}function I(){if(!a("#easytree-reject").length){var b='<div id="easytree-reject" class="easytree-drag-helper easytree-drop-reject">';b+='<span class="easytree-drag-helper-img"></span>',b+="</div>",a("body").append(b)}if(!a("#easytree-accept").length){var c='<div id="easytree-accept" class="easytree-drag-helper easytree-drop-accept">';c+='<span class="easytree-drag-helper-img"></span>',c+="</div>",a("body").append(c)}}function J(b,c,d){a.ajax({url:b,type:"get",contentType:"application/json; charset=utf-8",data:c,success:d,error:function(a,b,c){alert("Error: "+a.responseText)}})}function K(b){var c=null;return"object"==typeof b?c=b:"string"==typeof b&&(b=a.trim(b),c=0==b.indexOf("[")||0==b.indexOf("{")?a.parseJSON(b):L(b)),c}function L(b){var c=a(b),d=[];c.children().each(function(a){d.push(M(this))});return d}function M(b){var c=a(b),d={},e=c.data();d.isActive=c.hasClass("isActive"),c.removeClass("isActive"),d.isFolder=c.hasClass("isFolder"),c.removeClass("isFolder"),d.isExpanded=c.hasClass("isExpanded"),c.removeClass("isExpanded"),d.isLazy=c.hasClass("isLazy"),c.removeClass("isLazy"),d.uiIcon=e.uiicon,d.liClass=c.attr("class"),d.id=c.attr("id");var f=c.children("a");f&&(d.href=f.attr("href"),d.hrefTarget=f.attr("target"));var g=c.children("img");g&&(d.iconUrl=g.attr("src")),d.textCss="";var h=c.children("span");h&&h.attr("class")&&(d.textCss+=h.attr("class")+" "),h=f.children("span"),h&&h.attr("class")&&(d.textCss+=h.attr("class")+" "),h=g.children("span"),h&&h.attr("class")&&(d.textCss+=h.attr("class")+" "),d.text=N(c[0]),d.tooltip=c.attr("title"),d.children=[];c.children("ul").children("li").each(function(a){d.children.push(M(this))});return d}function N(b){var c=0;for(c=0;c<b.childNodes.length;c++)for(var d=b.childNodes[c];d;){if(3==d.nodeType&&a.trim(d.nodeValue).length>0)return a.trim(d.nodeValue);d=d.firstChild}return""}function O(a){a||(a="null")}var P,Q={allowActivate:!0,data:null,dataUrl:null,dataUrlJson:null,disableIcons:!1,enableDnd:!1,ordering:null,slidingTime:100,minOpenLevels:0,building:null,built:null,toggling:null,toggled:null,opening:null,opened:null,openLazyNode:null,closing:null,closed:null,canDrop:null,dropping:null,dropped:null,stateChanged:null},R=null,S=new Object;this.init=function(b,c){Q=a.extend(Q,c),H(),P=b;var d="";if(Q.dataUrl)J(Q.dataUrl,Q.dataUrlJson,function(a){return(d=K(a))?(w(d),this):(alert("EasyTree: Invalid data!"),this)});else if(Q.data){if(d=K(Q.data),!d)return alert("EasyTree: Invalid data!"),this;w(d)}else{if(d=K(P.text()),!d)return alert("EasyTree: Invalid data!"),this;w(d)}return this},this.options=Q,this.rebuildTree=function(a){var b=a?K(a):R;b||alert("EasyTree: Invalid data!"),w(b)},this.getAllNodes=function(){return R},this.getNode=function(a){return o(R,a)},this.addNode=function(a,b){if(!b)return void R.push(a);var c=o(R,b);a&&(c.children||(c.children=[]),c.children.push(a))},this.removeNode=function(a){q(R,a)},this.activateNode=function(b){if(s(R),Q.allowActivate){var c=o(R,b);c&&(c.isActive=!0,a("#"+c.id).addClass("easytree-active"))}},this.toggleNode=function(a){var b=o(R,a);b&&f(null,R,b)},this.toggleNodes=function(a){a&&f(null,R,a)},this.init(b,c)}}(jQuery);