/*! dev.egret.com - v1.0.0 - 2016-08-03 */function yx_confirm(a){Wind.use("artDialog","iframeTools",function(){art.dialog(a)})}function resultTip(a){var b=0!=a.error?"success":"warning",c='<div class="alert alert-'+b+' alert-dismissible" style="position: fixed;right: 0;bottom: 0;-moz-border-radius: 5px; -webkit-border-radius: 5px; border-radius: 5px; " role="alert">';c+='<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>',c+="<strong>"+a.msg+"</strong>",c+="</div>",c=$(c),c.appendTo($("body")).fadeIn(function(){}).delay(4500).fadeOut(function(){c.remove(),a.callback&&a.callback()})}function popPos(a){var b,c=!1,d="fixed",e=$(window).height(),f=a.outerHeight();$.browser.msie&&$.browser.version<7&&(c=!0,d="absolute"),b=e<f?0:($(window).height()-a.outerHeight())/2,a.css({position:d,top:b+(c?$(document).scrollTop():0),left:($(window).width()-a.innerWidth())/2}).show()}function yx_ajaxForm(e){e.preventDefault();var btn=$(e.currentTarget);form=btn.parents("form.J_ajaxForm"),btn.data("loading")||($.browser.msie&&form.find("[placeholder]").each(function(){var a=$(this);a.val()==a.attr("placeholder")&&a.val("")}),Wind.use("ajaxForm","noty",function(){form.ajaxSubmit({url:btn.data("action")?btn.data("action"):form.attr("action"),dataType:"json",beforeSubmit:function(){btn.data("loading",!0);var a=btn.text();btn.text(a+"中...").prop("disabled",!0).addClass("disabled")},success:function(data){var text=btn.text();if(btn.removeClass("disabled").text(text.replace("中...","")).parent().find("span").remove(),"success"===data.state)noty({text:data.info,type:"success",layout:"center"});else if("fail"===data.state){var $verify_img=form.find(".verify_img");$verify_img.length&&$verify_img.attr("src",$verify_img.attr("src")+"&refresh="+Math.random()),noty({text:data.info,type:"error",layout:"center"}),btn.removeProp("disabled").removeClass("disabled")}if(data.type)return"function"===data.type?eval(data.name+"("+data.data+")"):"modal-content-add"===data.type&&$("#"+data.name).html(data.info),void(null!==data.modal&&($(".modal").modal("hide"),$(".modal-backdrop").remove(),eval("$('#"+data.modal+"').modal('"+data.modalshow+"')")));if(data.referer){var wait=btn.data("wait");wait||(wait=1500),window.parent.art?wait?setTimeout(function(){window.parent.location.href=data.referer},wait):window.parent.location.href=data.referer:wait?setTimeout(function(){window.location.href=data.referer},wait):window.location.href=data.referer}else"success"===data.state&&reloadPage(window.parent.art?window.parent:window)},complete:function(){btn.data("loading",!1)}})}))}function yx_modal_a(e){if(e.preventDefault(),is_yx_modal_a){is_yx_modal_a=!1;var btn=$(e.currentTarget),url=btn.attr("href");$.ajax({url:url,dataType:"json",type:"POST",beforeSend:function(){btn.prop("disabled",!0).addClass("disabled")},success:function(data,textStatus,jqXHR){btn.removeProp("disabled").removeClass("disabled"),"success"===data.state?data.type&&("function"===data.type?eval(data.name+"()"):"modal-content-add"===data.type&&$("#"+data.name).html(data.info),null!==data.modal&&eval("$('#"+data.modal+"').modal('"+data.modalshow+"')")):"fail"===data.state,is_yx_modal_a=!0}})}}function yx_count_btn(){var a=$("a.J_count_btn");a.length&&Wind.use("noty",function(){a.on("click",function(a){a.preventDefault();var b=$(this),c=b.prop("href");$.post(c,{},function(a){if("success"===a.state){var c=b.find(".count");0==c.length&&(c=$(".count"));var d=parseInt(c.text());c.text(d+1),a.info&&noty({text:a.info,type:"success",layout:"center"})}else"fail"===a.state&&noty({text:a.info,type:"error",layout:"center"})},"json")})})}function yx_favorite_btn(){var a=$("a.J_favorite_btn");a.length&&Wind.use("noty",function(){a.on("click",function(a){a.preventDefault();var b=$(this),c=b.prop("href"),d=b.data("url"),e=b.data("key"),f=b.data("title"),g=b.data("description");$.post(c,{url:d,key:e,title:f,description:g},function(a){"success"===a.state?a.info&&noty({text:a.info,type:"success",layout:"center"}):"fail"===a.state&&noty({text:a.info,type:"error",layout:"center"})},"json")})})}function yx_comment_form(){var a=$(".comment-area .comment-form");a.length&&Wind.use("ajaxForm",function(){$(".J_ajax_submit_btn",a).on("click",function(a){var b=$(this),c=b.parents(".comment-form");a.preventDefault();var d=b.data("action")?b.data("action"):c.attr("action"),e=c.serialize()+"&url="+encodeURIComponent(location.href);return $.ajax({url:d,dataType:"json",type:"POST",beforeSend:function(){var a=b.text();b.text(a+"中...").prop("disabled",!0).addClass("disabled")},data:e,success:function(a,d,e){var f=b.text();if(b.removeClass("disabled").text(f.replace("中...","")).parent().find("span").remove(),b.removeProp("disabled").removeClass("disabled"),"success"===a.state?$('<span class="tips_success">'+a.info+"</span>").appendTo(b.parent()).fadeIn("slow").delay(1e3).fadeOut(function(){}):"fail"===a.state&&($('<span class="tips_error">'+a.info+"</span>").appendTo(b.parent()).fadeIn("fast"),b.removeProp("disabled").removeClass("disabled")),"success"===a.state){var g=c.siblings(".comments"),h=b.parents(".comment-area").find(".comment-tpl").html(),i=$(h);i.attr("data-id",a.data.id);var j=c.find(".comment-postbox"),k=j.val();i.find(".comment-content .content").html(k),g.append(i),j.val(""),"mdDocComment"===b.attr("data")&&$("#comments").html(a.info)}}}),!1})})}function comment_reply(a){$(".comments .comment-reply-submit").hide();var b=$(a),c=b.parents(".comments > .comment> .comment-body"),d=b.parents(".comment").data("id"),e=c.find(".comment-reply-submit");if(e.length)e.show();else{var f=c.parents(".comment-area").find(".comment-reply-box-tpl").html();e=$(f),c.append(e)}e.find(".textbox").focus(),e.data("replyid",d)}function comment_reply_bak(a){$(".comments .comment-reply-submit").hide();var b=$(a),c=b.parents(".comments > .comment> .comment-body"),d=b.parents(".comment").data("id"),e=c.find(".comment-reply-submit");if(e.length)e.show();else{var f=c.parents(".comment-area").find(".comment-reply-box-tpl").html();e=$(f),c.append(e)}e.find(".textbox").focus(),e.data("replyid",d)}function comment_submit(a){Wind.use("noty",function(){if(null!=$("#main-menu-user-nicename")&&""==$("#main-menu-user-nicename").text())return void alert("未登录状态不能评论！");var b=$(a),c=b.parents(".comment-reply-submit"),d=c.find(".textbox"),e=d.val();if(""==e)return void d.focus();var f=b.parents(".comments > .comment> .comment-body"),g=f.parents(".comment-area").find(".comment-tpl").html(),h=$(g),i=c.data("replyid"),j=$(".comments [data-id='"+i+"']"),k=j.data("username"),l="回复 "+k+":"+e;h.find(".comment-content .content").html(l),c.before(h);var m=b.parents(".comment-area").find(".comment-form"),n=m.attr("action"),o=m.find("[name='post_table']").val(),p=m.find("[name='post_id']").val(),q=j.data("uid");$.post(n,{post_table:o,post_id:p,to_uid:q,parentid:i,content:e,url:encodeURIComponent(location.href)},function(a){0==a.status&&(noty({text:a.info,type:"error",layout:"center"}),h.remove()),1==a.status&&(h.attr("data-id",a.data.id),d.val(""))},"json"),c.hide()})}function reloadPage(a){a||(a=window);var b=a.location;b.href=b.pathname+b.search}function redirect(a){location.href=a}function getCookie(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1,e.length);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return null}function setCookie(a,b,c){var d=setCookie.arguments.length,e=setCookie.arguments,f=d>5&&e[5],g=new Date;null!=c&&0!=c||(c=1),g.setTime(g.getTime()+864e5*c),document.cookie=a+"="+escape(b)+"; path=/"+(1==f?"; secure":"")+";expires="+g.toGMTString()}function openwinx(a,b,c,d){c||(c=screen.width),d||(d=screen.height),window.open(a,b)}function confirmurl(a,b){Wind.use("artDialog","iframeTools",function(){art.dialog.confirm(b,function(){location.href=a},function(){art.dialog.tips("你取消了操作")})})}function open_iframe_dialog(a,b,c){var d={title:b,lock:!0,opacity:0,width:"95%"};d=c?$.extend(d,c):d,Wind.use("artDialog","iframeTools",function(){art.dialog.open(a,d)})}var is_yx_modal_a=!0;yx_count_btn(),yx_favorite_btn(),function(){$.ajaxSetup({complete:function(a){},data:{},error:function(a,b,c){}}),""!==document.createElement("input").placeholder&&$("[placeholder]").focus(function(){var a=$(this);a.val()==a.attr("placeholder")&&(a.val(""),a.removeClass("placeholder"))}).blur(function(){var a=$(this);""!=a.val()&&a.val()!=a.attr("placeholder")||(a.addClass("placeholder"),a.val(a.attr("placeholder")))}).blur().parents("form").submit(function(){$(this).find("[placeholder]").each(function(){var a=$(this);a.val()==a.attr("placeholder")&&a.val("")})}),$("a.J_dialog").length&&Wind.use("artDialog","iframeTools",function(){$(".J_dialog").on("click",function(a){a.preventDefault();var b=this,c=$(b);art.dialog.open($(this).prop("href"),{close:function(){return b.focus(),!0},title:c.prop("title")})}).attr("role","button")});var ajaxForm_list=$("form.J_ajaxForm");ajaxForm_list.length&&Wind.use("ajaxForm","noty",function(){$.browser.msie&&ajaxForm_list.on("submit",function(a){a.preventDefault()}),$("button.J_ajax_submit_btn").on("click",function(e){e.preventDefault();var btn=$(this),form=btn.parents("form.J_ajaxForm");if(!btn.data("loading")){if(btn.data("subcheck")){if(btn.parent().find("span").remove(),form.find("input.J_check:checked").length){var msg=btn.data("msg");msg?noty({text:msg,type:"confirm",layout:"center",timeout:!1,modal:!0,buttons:[{addClass:"btn btn-primary",text:"确定",onClick:function(a){a.close(),btn.data("subcheck",!1),btn.click()}},{addClass:"btn btn-danger",text:"取消",onClick:function(a){a.close()}}]}):(btn.data("subcheck",!1),btn.click())}else noty({text:"请至少选择一项",type:"error",layout:"center"});return!1}$.browser.msie&&form.find("[placeholder]").each(function(){var a=$(this);a.val()==a.attr("placeholder")&&a.val("")}),form.ajaxSubmit({url:btn.data("action")?btn.data("action"):form.attr("action"),dataType:"json",beforeSubmit:function(a,b,c){btn.data("loading",!0);var d=btn.text();btn.text(d+"中...").prop("disabled",!0).addClass("disabled")},success:function(data,statusText,xhr,$form){var text=btn.text();if(btn.removeClass("disabled").text(text.replace("中...","")).parent().find("span").remove(),"success"===data.state)noty({text:data.info,type:"success",layout:"center"});else if("fail"===data.state){var $verify_img=form.find(".verify_img");$verify_img.length&&$verify_img.attr("src",$verify_img.attr("src")+"&refresh="+Math.random()),noty({text:data.info,type:"error",layout:"center"}),btn.removeProp("disabled").removeClass("disabled")}if(data.type)return"function"===data.type?eval(data.name+"()"):"modal-content-add"===data.type&&$("#"+data.name).html(data.info),void(null!==data.modal&&eval("$('#"+data.modal+"').modal('"+data.modalshow+"')"));if(data.referer){var wait=btn.data("wait");wait||(wait=1500),window.parent.art?wait?setTimeout(function(){window.parent.location.href=data.referer},wait):window.parent.location.href=data.referer:wait?setTimeout(function(){window.location.href=data.referer},wait):window.location.href=data.referer}else"success"===data.state&&reloadPage(window.parent.art?window.parent:window)},complete:function(){btn.data("loading",!1)}})}})}),$("#J_dialog_close").on("click",function(a){a.preventDefault();try{art.dialog.close()}catch(a){Wind.use("artDialog","iframeTools",function(){art.dialog.close()})}}),$("a.J_ajax_del").length&&Wind.use("noty",function(){$(".J_ajax_del").on("click",function(a){a.preventDefault();var b=this,c=$(b),d=c.prop("href"),e=c.data("msg");noty({text:e,type:"confirm",layout:"center",timeout:!1,modal:!0,buttons:[{addClass:"btn btn-primary",text:"确定",onClick:function(a){a.close(),$.getJSON(d).done(function(a){"success"===a.state?a.referer?location.href=a.referer:reloadPage(window):"fail"===a.state&&alert(a.info)})}},{addClass:"btn btn-danger",text:"取消",onClick:function(a){a.close()}}]})})}),$("a.J_ajax_dialog_btn").length&&Wind.use("noty",function(){$(".J_ajax_dialog_btn").on("click",function(a){a.preventDefault();var b=this,c=$(b),d=c.prop("href"),e=c.data("msg");noty({text:e,type:"confirm",layout:"center",timeout:!1,modal:!0,buttons:[{addClass:"btn btn-primary",text:"确定",onClick:function(a){a.close(),$.getJSON(d).done(function(a){"success"===a.state?a.referer?location.href=a.referer:reloadPage(window):"fail"===a.state&&art.dialog.alert(a.info)})}},{addClass:"btn btn-danger",text:"取消",onClick:function(a){a.close()}}]})})});var ajax_refresh=$("a.J_ajax_refresh"),refresh_lock=!1;ajax_refresh.length&&ajax_refresh.on("click",function(a){return a.preventDefault(),!refresh_lock&&(refresh_lock=!0,void $.post(this.href,function(a){refresh_lock=!1,"success"===a.state?a.referer?location.href=a.referer:reloadPage(window):"fail"===a.state&&Wind.art.dialog.alert(a.info)},"json"))});var dateInput=$("input.J_date");dateInput.length&&Wind.use("datePicker",function(){dateInput.datePicker()});var dateTimeInput=$("input.J_datetime");dateTimeInput.length&&Wind.use("datePicker",function(){dateTimeInput.datePicker({time:!0})});var $J_action_btn=$("a.J_action_btn");$J_action_btn.length&&Wind.use("noty",function(){$J_action_btn.on("click",function(a){a.preventDefault();var b=$(this),c=b.prop("href");$.post(c,{},function(a){"success"===a.state?a.info&&noty({text:a.info,type:"success",layout:"center"}):"fail"===a.state&&noty({text:a.info,type:"error",layout:"center"})},"json")})})}(),yx_comment_form();