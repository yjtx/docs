var indexeddb=function(){function e(){this.db=null,this.dbName="editormddb",this.tableName="res",this.list=[],this.uploadURL="",this.$=jQuery}return e.prototype["delete"]=function(){var e=window.indexedDB.deleteDatabase(this.dbName);e.onsuccess=function(e){console.log("success delete db")},e.onerror=function(e){console.log("Database error: "+e.target.errorCode)}},e.prototype.close=function(){this.db.close()},e.prototype.all=function(e){var t=this,a=indexedDB.open(t.dbName);a.onupgradeneeded=function(){var e=a.result;e.objectStoreNames.contains(t.tableName)||e.createObjectStore(t.tableName,{keyPath:"id"})},a.onsuccess=function(){t.list=[];var o=a.result,n=o.transaction(t.tableName,"readwrite"),r=n.objectStore(t.tableName),s=r.openCursor();s.onsuccess=function(a){var o=s.result;o?(t.list.push(o.value),o["continue"]()):e&&e(t.list)}}},e.prototype.get=function(e,t){},e.prototype.put=function(e,t){void 0===t&&(t=!1);var a=this,o=indexedDB.open(a.dbName);o.onupgradeneeded=function(){var e=o.result;e.objectStoreNames.contains(a.tableName)||e.createObjectStore(a.tableName,{keyPath:"id"})},o.onsuccess=function(){var n=o.result,r=n.transaction(a.tableName,"readwrite"),s=r.objectStore(a.tableName),c=s.get(e.id);c.onsuccess=function(o){var n=o.target.result;t?s.put(e):void 0===n&&s.put(e),a.uploadAll()}}},e.prototype.uploadAll=function(){var e=this;e.all(function(t){for(var a=0;a<e.list.length;a++)if(0===e.list[a].status){e.updateStatus(e.list[a]);break}})},e.prototype.updateStatus=function(e){var t=this,a=indexedDB.open(t.dbName);a.onupgradeneeded=function(){var e=a.result;e.objectStoreNames.contains(t.tableName)||e.createObjectStore(t.tableName,{keyPath:"id"})},a.onsuccess=function(){var o=a.result,n=o.transaction(t.tableName,"readwrite"),r=n.objectStore(t.tableName),s=r.get(e.id);s.onsuccess=function(a){var o=a.target.result;void 0!==o&&0===o.status&&t.ajax(e)}}},e.prototype.status=function(e,t){var a=this,o=indexedDB.open(a.dbName);o.onupgradeneeded=function(){var e=o.result;e.objectStoreNames.contains(a.tableName)||e.createObjectStore(a.tableName,{keyPath:"id"})},o.onsuccess=function(){var n=o.result,r=n.transaction(a.tableName,"readwrite"),s=r.objectStore(a.tableName),c=s.get(e.id);c.onsuccess=function(e){var a=e.target.result;a.status=t,s.put(a)}}},e.prototype.ajax=function(e){var t=this;$.ajax({type:"POST",data:e,url:t.uploadURL,dataType:"json",success:function(a){1==a.success?t.status(e,1):console.log("error indexeddb ajax upload"),t.uploadAll()},error:function(e){console.log("error indexeddb ajax "+e)}})},e}();